' Gambas class file

Public js As CJSON = New CJSON As "JParse"
Private m_json_icons As New Collection


Public Sub cmdDecode_Click()
Dim iResult As Integer
' Dim js As New CJSON
  js.Clear
  tvJson.Clear()
  js.LineNoWidth = 6
  js.URL = txtWorkingFile.Text
  iResult = js.open()
End

Public Sub cmdOpen_Click()

Dialog.Title = "Choose a file"
Dialog.Filter = ["*.json", "JSON Files", "*", "All files"]
Dialog.Path = "."
If Dialog.OpenFile() Then
  Return ' User pressed Cancel -
Endif
txtWorkingFile.Text = Dialog.path 

End

Public Sub cmbGetName_Click()

  Print js.GetNameFromPath(txtPath.Text)

End


Private Sub DisplayIcons()

  Dim iconKey As String
  Dim iconName As String
  Dim v As Variant
  ' IconViewIcons.Clear()

 
  For Each v In m_json_icons
    

    iconKey = m_json_icons.Key
   ' IconViewIcons.Add(iconKey, iconKey, v)

  Next

End

Public Sub Form_Open()
Dim lPath As String
Dim lFlags As New Byte[2]

' "Boolean", "Number", "String", "Array", "Object"
lPath = Application.Path & "/icons/"
   With m_json_icons
    .Add(Picture.Load(lpath & "json-array.png"), "Array")
   .Add(Picture.Load(lpath & "json-boolean.png"), "Boolean")
   .Add(Picture.Load(lpath & "json-member.png"), "Member")
   .Add(Picture.Load(lpath & "json-null.png"), "Null")
   .Add(Picture.Load(lpath & "json-number.png"), "Number")
   .Add(Picture.Load(lpath & "json-object.png"), "Object")
   .Add(Picture.Load(lpath & "json-string.png"), "String")
   End With
   lFlags[0] = 0 ' &H30 ' To turn it all on use &H30
   lFlags[1] = &H30 '&H30 ' To turn it all on use &H30
   zns.debugger = New CDebug(lFlags)
End


Public Sub JParse_Added(key As String, name As String, value As String, type As String)
  
  zns.debugger.Message(modJSONParse.getParent(key) & Chr$(9) & key & Chr$(9) & "\"" & name & "\" : " & value & Chr$(9) & type, LogLevel.Info)
  If tvJson.Exist(modJSONParse.getParent(key)) Then 
    tvJson.Add(key, name, m_json_icons[type], modJSONParse.getParent(key))
  Else
    tvJson.Add(key, name, m_json_icons[type])
  Endif
End


Public Sub JParse_DebugMessage(msg As String, iLevel As Integer)
  
  zns.debugger.Message(msg, iLevel)
  
End





Public Sub tvJson_Click()

  Print "Key " & tvJson.Item.Key & " ==> \"" & tvJson.Item.Text & "\" : " & js.GetNameFromPath(tvJson.Item.Key)
  
  

End

Public Sub cmdUnitTest_Click()
  
  modUnitTest.UnitTests(js, tvJson)
  ' modUnitTest.PrintDirectory("./json-test")

  
End
